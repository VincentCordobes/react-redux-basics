<h1 id="draft-react-redux">Draft React-Redux</h1>
<h2 id="react">React</h2>
<h3 id="les-bases">Les bases</h3>
<p>React est une biblioth√®que javascript permettant de <strong>construire des interfaces graphiques composables</strong>.</p>
<p>La mod√©lisation des interfaces graphiques d'une application au cours du temps est un sujet complexe. Il est, en effet, difficile de suivre l'√©tat d'une application, apr√®s une s√©rie d'interactions utilisateur et/ou externes. Dans un SPA, nous ne pouvons plus compter sur des rechargements entiers d'une page web pour garder une interface synchronis√©e et coh√©rente.</p>
<p>La solution de React est de d√©crire ‚Äú√† quoi‚Äù l'application doit ressembler √† n'importe quel instant donn√© ‚Üí construction de l'<em>UI</em> de mani√®re <strong>d√©clarative</strong>. Ce fonctionnement nous donne l'impression que React redessine enti√®rement l'interface √† chaque <em>update</em> (uniquement une impression ‚Üí cf <em>DOM virtuel</em>) Cela rend la conception et le d√©veloppement d'application consid√©rablement plus simple et nous permet de garder tr√®s facilement l'interface √† jour avec un mod√®le de donn√©es. L'√©laboration de ces interfaces se fait √† base de <strong>composants React</strong>.</p>
<p>On pourrait assimiler un <strong>composant React</strong> √† une <strong>fonction</strong>. C'est d'ailleurs une des 2 mani√®res possibles d'√©crire une composant React.</p>
<p>L'API des composants est tr√®s simple. Un composant <em>peut</em> poss√©der : - un <strong>state</strong> - des propri√©t√©s : les donn√©es d'entr√©es du composant ‚Üí <strong>props</strong> - Une m√©thode <strong>render</strong> charg√©e du rendu du composant, appel√©e lorsque son <em>state</em> ou une de ses <em>props</em> changent. - Des m√©thodes li√©es au <strong>cycle de vie</strong> du composant <code>componentDidMount</code>, <code>componentWillReceiveProps</code> etc...)</p>
<h4 id="√©criture-avec-les-classes-es6">√âcriture avec les classes ES6</h4>
<p>Ci-dessous un composant React ayant pour seule vocation d'afficher la propri√©t√© <em>user</em>. Si <em>user</em> change, React redessine la partie du composant ayant chang√©.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">class</span> Bonjour <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span>
  <span class="at">render</span>() <span class="op">{</span>
    <span class="cf">return</span> <span class="op">&lt;</span>div<span class="op">&gt;</span>Bonjour <span class="op">{</span><span class="kw">this</span>.<span class="va">props</span>.<span class="at">user</span><span class="op">}&lt;</span><span class="ss">/div&gt;</span>
<span class="ss">  }</span>
<span class="ss">}</span></code></pre></div>
<h4 id="√©criture-sous-forme-de-fonction">√âcriture sous forme de fonction</h4>
<p>Ce composant peut aussi √™tre √©crit sous la forme d'une fonction appel√©e <strong>Stateless functional component</strong>.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">const</span> Bonjour <span class="op">=</span> (props) <span class="op">=&gt;</span> (
  <span class="op">&lt;</span>div<span class="op">&gt;</span>Bonjour <span class="op">{</span><span class="kw">this</span>.<span class="va">props</span>.<span class="at">user</span><span class="op">}&lt;</span><span class="ss">/div&gt;</span>
<span class="sc">)</span></code></pre></div>
<p>Ce type de composant <strong>ne poss√®de pas de <em>state</em>, pas d'instance ni de m√©thodes li√©es au cycle de vie</strong> d'un composant React. Il ne s'agit que d'une simple fonction retournant un r√©sultat en fonction de ses arguments (les <em>props</em>) Cette √©criture √©tant plus concise, elle est √† privil√©gier dans la mesure du possible.</p>
<h4 id="dessiner-un-composant-dans-un-n≈ìud-du-dom">Dessiner un composant dans un n≈ìud du DOM</h4>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">ReactDOM</span>.<span class="at">render</span>(
  <span class="op">&lt;</span>Bonjour user<span class="op">=</span><span class="st">&quot;Vincent&quot;</span> <span class="ss">/&gt;,</span>
<span class="ss">  document.getElementById</span><span class="sc">(</span><span class="ss">&#39;root&#39;</span><span class="sc">)</span>
<span class="sc">)</span></code></pre></div>
<p>Pour dessiner le composant dans le DOM il suffit d'appeler la m√©thode <code>ReactDOM.render</code> avec ledit Composant et le n≈ìud du DOM o√π l'on souhaite le dessiner</p>
<h4 id="jsx">JSX</h4>
<p>Le code &quot;XML like&quot; que retourne la m√©thode <em>render</em> s'appelle du <strong>JSX</strong> et est un sucre syntaxique permettant de cr√©er les n≈ìuds React. L'utilisation du JSX n'est pas obligatoire. Voici la correspondance du code JSX :</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="op">&lt;</span>Bonjour user<span class="op">=</span><span class="st">&quot;Vincent&quot;</span> <span class="ss">/&gt;</span></code></pre></div>
<p>Avec le code javascript √©quivalent :</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">React</span>.<span class="at">createElement</span>(<span class="st">&#39;Bonjour&#39;</span><span class="op">,</span> <span class="op">{</span>
  <span class="dt">user</span><span class="op">:</span> <span class="st">&#39;Vincent&#39;</span>
<span class="op">}</span>)<span class="op">;</span></code></pre></div>
<h3 id="distinguer-2-types-de-composants-react">Distinguer 2 types de composants React</h3>
<p>D'un point de vue architectural, nous pouvons tr√®s vite distinguer deux types de composants. Redux (cf : suite de l'article) parle de <strong>container component</strong> (ou <em>smart component</em>) et de <strong>presentational component</strong> (ou <em>dumb component</em>) Si l'on se rapportait √† une architecture <em>MVC</em> plus traditionnelle, le premier correspondrait au <strong>C</strong>ontrolleur et le deuxi√®me √† la <strong>V</strong>ue. <strong>On s√©pare donc les composants responsables de la logique m√©tier/orchestration des actions, de ceux reponsables de la vue</strong></p>
<h4 id="exemple">Exemple</h4>
<p>Consid√©rons un composant qui affiche une liste de pistes (<em>tracks</em>) provenant d'une api.</p>
<p>Le code ci-dessous est <strong>moyen</strong> üëø, en effet un m√™me composant <strong>ne devrait pas</strong> √™tre responsable √† la fois : - d'aller chercher les donn√©es de l'api et potentiellement les transformer<br />
- d'afficher et mettre en forme ces donn√©es</p>
<p>Ce manque de s√©paration entre la vue et la logique m√©tier peut tr√®s vite rendre le code difficile √† maintenir lorsque ce dernier grossit.</p>
<h5 id="un-mauvais-composant">‚úò Un &quot;mauvais&quot; composant :</h5>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">class</span> TrackList <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span>
  state <span class="op">=</span> <span class="op">{</span> <span class="dt">tracks</span><span class="op">:</span> [] <span class="op">}</span>

  <span class="at">componentDidMount</span>() <span class="op">{</span>
    <span class="va">axios</span>.<span class="at">get</span>(<span class="st">&#39;/tracks&#39;</span>)
      .<span class="at">then</span>(response <span class="op">=&gt;</span> <span class="va">response</span>.<span class="at">data</span>)
      .<span class="at">then</span>(tracks <span class="op">=&gt;</span> <span class="kw">this</span>.<span class="at">setState</span>(<span class="op">{</span> tracks <span class="op">}</span>))
      .<span class="at">catch</span>(handleError)<span class="op">;</span>
  <span class="op">}</span>

  <span class="at">render</span>() <span class="op">{</span>
    <span class="cf">return</span> (
      <span class="op">&lt;</span>ul<span class="op">&gt;</span>
        <span class="op">{</span><span class="kw">this</span>.<span class="va">state</span>.<span class="va">tracks</span>.<span class="at">map</span>(track <span class="op">=&gt;</span> (
          <span class="op">&lt;</span>li<span class="op">&gt;{</span>track<span class="op">}&lt;</span><span class="ss">/li&gt;</span>
<span class="ss">        </span><span class="sc">))</span><span class="ss">}</span>
<span class="ss">      &lt;/ul</span><span class="op">&gt;</span>
    )
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>Nous pouvons le s√©parer en 2 composants, le premier √©tant un composant &quot;container&quot; et le deuxi√®me un composant visuel.</p>
<h5 id="composant-container">‚úî Composant <em>Container</em> :</h5>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// LOgic is here!! </span>
<span class="co">// we have completely separated our logic and our view</span>
<span class="kw">class</span> TrackListContainer <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span>
  state <span class="op">=</span> <span class="op">{</span> <span class="dt">tracks</span><span class="op">:</span> [] <span class="op">}</span>

  <span class="at">componentDidMount</span>() <span class="op">{</span>
    <span class="va">axios</span>.<span class="at">get</span>(<span class="st">&#39;/tracks&#39;</span>)
      .<span class="at">then</span>(response <span class="op">=&gt;</span> <span class="va">response</span>.<span class="at">data</span>)
      .<span class="at">then</span>(tracks <span class="op">=&gt;</span> <span class="kw">this</span>.<span class="at">setState</span>(<span class="op">{</span> tracks <span class="op">}</span>))
      .<span class="at">catch</span>(handleError)<span class="op">;</span>
  <span class="op">}</span>

  <span class="at">render</span>() <span class="op">{</span>
    <span class="co">// This is our view </span>
    <span class="co">// and the `tracks` props is like our ViewModel </span>
    <span class="cf">return</span> <span class="op">&lt;</span>TrackList tracks<span class="op">={</span><span class="kw">this</span>.<span class="va">state</span>.<span class="at">tracks</span><span class="op">}</span> <span class="ss">/&gt;</span>
<span class="ss">  }</span>
<span class="ss">}</span></code></pre></div>
<h5 id="composant-presentational">‚úî Composant <em>Presentational</em> :</h5>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// here is our view</span>
<span class="kw">const</span> TrackList <span class="op">=</span> (<span class="op">{</span> tracks <span class="op">}</span>) <span class="op">=&gt;</span> (
  <span class="op">&lt;</span>ul<span class="op">&gt;</span>
    <span class="op">{</span><span class="kw">this</span>.<span class="va">state</span>.<span class="va">tracks</span>.<span class="at">map</span>(track <span class="op">=&gt;</span> (
      <span class="op">&lt;</span>li<span class="op">&gt;{</span>track<span class="op">}&lt;</span><span class="ss">/li&gt;</span>
<span class="ss">    </span><span class="sc">))</span><span class="ss">}</span>
<span class="ss">  &lt;/ul</span><span class="op">&gt;</span>
)</code></pre></div>
<h3 id="dom-virtuel">DOM Virtuel</h3>
<p>Lorsque nous √©crivons un composant React, nous d√©crivons √† quoi l'UI ressemble en fonction des <em>props</em>. M√™me si React donne le sentiment au d√©veloppeur de repeindre enti√®rement le DOM √† chaque <em>update</em>, il impl√©mente, en r√©alit√©, un <strong>DOM virtuel</strong> qui est une repr√©sentation interne en javascript du DOM. Voici un sch√©ma illustrant le processus :</p>
<p align="center">
<img src="https://www.dropbox.com/s/ovawut1f5t6yfae/react_batch.svg?dl=1" width="600">
</p>
<h6 align="center">
React et son DOM virtuel
</h6>
<p>Lorsque le <span style="color: #D32F2F">mod√®le de donn√©es change</span> la m√©thode <em>render</em> du composant renvoie un objet correspondant √† la repr√©sentation interne du DOM virtuel. React compare ensuite ce nouveau DOM virtuel avec le pr√©c√©dent (algorithme de diff interne), et met √† jour le <em>vrai DOM</em> en appliquant un s√©rie d'op√©rations optimis√©es. Ce DOM virtuel permet donc d'optimiser les acc√®s au ‚Äúvrai DOM‚Äù, les modifications sont appliqu√©es en une fois.</p>
<h2 id="architecture-flux-redux">Architecture Flux : Redux</h2>
<h3 id="synoptique-technique">Synoptique technique</h3>
<p>Voici un sch√©ma illustrant l'architecture d'une application redux. Les diff√©rentes composantes de ce sch√©ma sont expliqu√©es dans la suite de ce document.</p>
<p align="center">
<img src="https://www.dropbox.com/s/eoqyq874z957s4i/synoptique.svg?dl=1" width="500">
</p>
<h6 align="center">
Synoptique technique React-Redux
</h6>
<blockquote>
<p>Note : Redux est une biblioth√®que dogmatique mettant en sc√®ne plusieurs concepts et <em>patterns</em> (immutabilit√©s, flux unidirectionnel etc...) et ces principes sous-jacents peuvent parfaitement s'appliquer √† d'autres architectures.</p>
</blockquote>
<h3 id="principe">Principe</h3>
<p><em>React</em> fournit seulement un moyen de dessiner de mani√®re efficace des composants en fonction de donn√©es d'entr√©es.</p>
<p><strong>Flux</strong> est un <em>pattern</em> permettant de g√©rer <strong>l'√©tat d'une application</strong> qui garanti un flux de donn√©es unidirectionnel (<em>one way databinding</em>) <strong>Redux</strong> est l'impl√©mentation la plus populaire.</p>
<p><em>Redux</em>, met en sc√®ne 3 principes :</p>
<ul>
<li><p><strong>une seule source de v√©rit√©</strong> : le <strong>state</strong> de l'application est maintenu dans une structure de donn√©es √† l'int√©rieur d'un seul <strong>store</strong></p></li>
<li><p><strong>le state est immutable</strong> : La seule mani√®re de modifier le <em>state</em> est via l'√©mission d'une <strong>action</strong>, un objet <strong>d√©crivant</strong> la modification √† apporter. Toutes les modifications sont centralis√©es et se produisent une √† une, √©vitant ainsi les probl√®mes de concurrence</p></li>
<li><p><strong>les modifications sont effectu√©es √† l'aide de fonction pures</strong> appel√©es <strong>reducers</strong></p></li>
</ul>
<p align="center">
<img src="https://www.dropbox.com/s/yst3zq1o0uxtas7/flux.svg?dl=1" width="540">
</p>
<h6 align="center">
Architecture Redux
</h6>
<p>Le sch√©ma illustre le flux unidirectionnel des donn√©es dans cette architecture : des <strong>actions</strong> sont <strong>‚Äúdispatch√©es‚Äù</strong> et trait√©es par le <strong>reducer</strong>, qui se charge de mettre √† jour le <strong>store</strong>. Toutes les vues (ici les composants react) abonn√©es au store se mettent √† jour en cons√©quence. Ces vues peuvent √©galement de &quot;dispatcher&quot; des actions et ainsi de suite.</p>
<h3 id="actions-et-actions-creators">Actions et <em>Actions creators</em></h3>
<p>Les <strong>actions</strong> sont des paquets de donn√©es envoy√©s au <em>store</em>. Elles sont la seule source d'information du store. Une action est envoy√©e au store gr√¢ce √† la fonction <code>store.dispatch</code>.</p>
<p>Voici un exemple d'action qui repr√©sente le changement de nom d'une personne :</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="op">{</span>
  <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;CHANGE_NAME&#39;</span><span class="op">,</span>
  <span class="dt">payload</span><span class="op">:</span> <span class="st">&#39;Vince&#39;</span>
<span class="op">}</span></code></pre></div>
<p>Si cette action se r√©v√®le √™tre utilis√©e souvent, nous pouvons √©crire une fonction qui se chargera de la cr√©er.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">function</span> <span class="at">changeName</span>(name) <span class="op">{</span>
  <span class="cf">return</span> <span class="op">{</span>
    <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;CHANGE_NAME&#39;</span><span class="op">,</span>
    <span class="dt">payload</span><span class="op">:</span> name
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>On appelle ces fonctions des <strong>action creator</strong>. Elles rendent les actions r√©utilisables et facilement testables. Les actions peuvent √™tre ‚Äúdispatch√©es‚Äù avec : <code>dispatch(changeName('Vincent'))</code></p>
<h3 id="reducer">Reducer</h3>
<p>Les actions d√©crivent le fait que quelque chose s'est pass√© mais ne sp√©cifient pas la mani√®re dont le store doit √™tre modifi√©. C'est le r√¥le du <strong>reducer</strong>. Le <strong>reducer</strong> est une <strong>fonction pure</strong> qui prend en param√®tre le <em>state</em>, une action, et retourne le nouveau <em>state</em>.</p>
<pre><code>(previousState, action) =&gt; nextState</code></pre>
<p>Le <em>reducer</em> est une fonction pure, par cons√©quent il ne doit <strong>jamais</strong>:</p>
<ul>
<li><p>modifier directement ses arguments</p></li>
<li><p>effectuer des op√©rations ayant des effets de bord tel que des appels √† une api</p></li>
<li><p>appeler des fonctions impures telles que <code>Date.now()</code> etc...</p></li>
</ul>
<p>Il est uniquement charg√© de calculer le <em>nextState</em>.</p>
<h4 id="exemple-un-reducer-incorrect-mutation-du-state-interdite">‚úò Exemple: un <em>reducer</em> incorrect : Mutation du <em>state</em> INTERDITE</h4>
<p>Le <em>state</em> est mut√©. La propri√©t√© du <em>state</em> √©tant modifi√©e directement (l.4), les composants abonn√©s √† cette partie du <em>state</em> ne se mettrons pas √† jour et ignorerons cette modification.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">function</span> <span class="at">user</span>(state <span class="op">=</span> <span class="op">{},</span> action) <span class="op">{</span>
  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span>
    <span class="cf">case</span> <span class="st">&#39;CHANGE_NAME&#39;</span><span class="op">:</span>
      <span class="va">state</span>.<span class="at">name</span> <span class="op">=</span> <span class="va">action</span>.<span class="at">name</span> <span class="co">// INTERDIT !!</span>
      <span class="cf">return</span> state<span class="op">;</span>
    <span class="dt">default</span><span class="op">:</span>
      <span class="cf">return</span> state<span class="op">;</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<h4 id="exemple-un-reducer-correct">‚úî Exemple Un <em>Reducer</em> correct</h4>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">function</span> <span class="at">user</span>(state <span class="op">=</span> <span class="op">{},</span> action) <span class="op">{</span>
  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span>
    <span class="cf">case</span> <span class="st">&#39;CHANGE_NAME&#39;</span><span class="op">:</span>
      <span class="cf">return</span> <span class="op">{</span>
        ...<span class="at">state</span><span class="op">,</span>
        <span class="dt">name</span><span class="op">:</span> <span class="va">action</span>.<span class="at">name</span><span class="op">,</span>
      <span class="op">}</span>
    <span class="dt">default</span><span class="op">:</span>
      <span class="cf">return</span> state<span class="op">;</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<blockquote>
<p>Note : On utilise ici l'op√©rateur <strong>object spread</strong> (<strong>...</strong>), une syntaxe d'<em>ECMAScript</em> 2016, qui permet de copier les propri√©t√©s d'un objet dans un nouvel objet d'une mani√®re plus succincte. Nous pouvons √©galement utiliser des biblioth√®ques qui garantissent l'immutabilit√© telles que <em><a href="https://github.com/facebook/immutable-js/">immutable.js</a></em> d√©velopp√©e par Facebook.</p>
</blockquote>
<!-- <h6>TODO: combineReducer pour r√©duire le boilerplate</h6> -->
<h3 id="store">Store</h3>
<p>Le <strong>store</strong> est un objet qui :</p>
<ul>
<li><p>maintient le <strong>state</strong> de l'application</p></li>
<li><p>permet l'acc√®s √† ce <em>state</em> via <code>getState()</code></p></li>
<li><p>permet de mettre √† jour le <em>state</em> via <code>dispatch(action)</code></p></li>
<li><p>permet d'abonner des composants via <code>subscribe(listener)</code> (composants notifi√©s lorsque le <em>state</em> subit une modification)</p></li>
</ul>
<h3 id="async-actions">Async Actions</h3>
<p>Afin d'orchestrer des flux asynchrones (par exemple, les appels r√©seaux) nous pouvons utiliser le <em>middleware</em> <em>Redux-thunk</em>. Ce <em>middleware</em> permet de traiter les <strong>actions</strong> √©tant des <strong>fonctions</strong> (appel√©es <em>thunk action</em>). Une action <em>thunk</em> ne doit pas forc√©ment √™tre pure et peut avoir des effets de bords. Les fonctions <em>dispatch</em> et <em>getState</em> du store lui sont pass√©es en argument, ce qui lui donne la possibilit√© de <em>dispatcher</em> d'autres <em>actions</em> et d'acc√©der au <em>state</em>.</p>
<h4 id="exemple-dun-thunk-action-creator-qui-retourne-une-fonction">Exemple d'un <em>thunk action creator</em> qui retourne une fonction :</h4>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">function</span> <span class="at">whatIsMyName</span>() <span class="op">{</span>
  <span class="cf">return</span> <span class="at">async</span> (dispatch<span class="op">,</span> getState) <span class="op">=&gt;</span> <span class="op">{</span>
    <span class="at">dispatch</span>(<span class="at">fetchNameRequest</span>())<span class="op">;</span>
    <span class="cf">try</span> <span class="op">{</span>
      <span class="kw">const</span> res <span class="op">=</span> await <span class="at">fetch</span>(<span class="st">&#39;http://vincent.cordobes/name&#39;</span>)<span class="op">;</span>
      <span class="kw">const</span> name <span class="op">=</span> await <span class="va">res</span>.<span class="at">json</span>()<span class="op">;</span>
      <span class="at">dispatch</span>(<span class="at">fetchNameSuccess</span>(name))<span class="op">;</span>
    <span class="op">}</span> <span class="cf">catch</span> (err) <span class="op">{</span>
      <span class="at">dispatch</span>(<span class="at">fetchNameError</span>(err))<span class="op">;</span>
    <span class="op">}</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>L'exemple ci-dessus met en √©vidence une <em>action creator</em> qui retourne une fonction. Des actions marquant le d√©but, le succ√®s ou une erreur de l'appel (l.5) √† l'API sont ‚Äúdispatch√©es‚Äù (l.3, l.7, l.9) permettant de mettre √† jour le <em>store</em> en fonction de l'avancement de la requ√™te.</p>
<blockquote>
<p>Remarques relativement au code ci-dessus : syntaxe avec les mots cl√©s <strong>async/await</strong>. Cette syntaxe fait son apparition dans ECMAScript 2017. En r√©sum√©, <code>await</code> permet d'attendre la r√©solution d'une promesse et ne peux √™tre utilis√© que dans une fonction pr√©fix√©e par <code>async</code> (elle-m√™me renverra √† son tour une promesse) Il permet d'√©crire le code asynchrone de javascript √† la mani√®re d'un code synchrone et ainsi √©viter les <em>callback hell</em> et donc rendre le code plus lisible. Il permet √©galement d'avoir une gestion d'erreur beaucoup plus agr√©able √† l'aide des <code>try/catch</code>.</p>
</blockquote>
<h2 id="composants-container-et-composants-visuels">Composants &quot;Container&quot; et composants &quot;visuels&quot;</h2>
<p>La s√©paration &quot;container&quot;/&quot;presentational&quot; est d'autant plus vrai dans redux. Ces deux termes proviennent, en l'occurrence, du cr√©ateur de redux. <img src="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0#.xbauu6f3x" alt="smart and dumb components" /></p>
<h3 id="container-composants"><em>Container</em> composants</h3>
<ul>
<li><p>Responsables de la mani√®re dont <strong>‚Äúles choses‚Äù fonctionnent</strong></p></li>
<li><p>Sont souvent <em>stateful</em> et servent de <strong>sources de donn√©es</strong></p></li>
<li><p><strong>‚ÄúDispatchent‚Äù les actions</strong> flux</p></li>
<li><p><strong>Transmettent</strong> des <strong>donn√©es et comportements</strong> aux composants &quot;presentational‚Äù <strong>via leur <em>props</em></strong></p></li>
<li><p>Peuvent contenir des composants ‚Äúpr√©sentation‚Äù et ‚Äúcontainer‚Äù</p></li>
<li><p><strong>Ne contiennent pas</strong> d'√©l√©ments du DOM ni de styles</p></li>
<li><p>Peuvent √™tre <strong>g√©n√©r√©s par connect()</strong></p></li>
</ul>
<h3 id="presentational-composants"><em>Presentational</em> composants</h3>
<ul>
<li><p>Responsables de la mani√®re dont <strong>‚Äúles choses‚Äù apparaissent sur l'interface</strong></p></li>
<li><p>Peuvent contenir des composants ‚Äúpr√©sentation‚Äù et ‚Äúcontainer‚Äù</p></li>
<li><p><strong>poss√®dent</strong> souvent des <strong>√©l√©ments DOM</strong> et du <strong>style</strong></p></li>
<li><p><strong>Ind√©pendants</strong> du reste de l'application</p></li>
<li><p>Ne sp√©cifient pas la mani√®re dont les donn√©es sont charg√©s ou modifi√©es</p></li>
<li><p><strong>Re√ßoivent</strong> les <strong>donn√©es et les callback</strong> exclusivement via leurs <strong>props</strong></p></li>
<li><p>Poss√®dent uniquement un <em>state</em> si celui-ci concerne l'UI (et non des data)</p></li>
<li><p>Souvent √©crits sous forme de fonctions</p></li>
</ul>
<h2 id="selectors">Selectors</h2>
<p>Afin de comprendre l'utilit√© des s√©lecteurs, prenons un exemple. Consid√©rons une liste de personnes, une recherche (par nom) et des filtres (sexe, age, etc...) sur ces personnes.</p>
<p>En suivant les principes <em>Redux</em>, le <em>store</em> contient les donn√©es et les crit√®res de recherche. √Ä partir de ces √©l√©ments nous pouvons calculer la liste filtr√©e √† afficher.</p>
<p>Une bonne pratique, concernant le <em>state</em>, est de contenir seulement des <em>donn√©e minimis√©e</em>, c'est-√†-dire des donn√©es ne pouvant pas √™tre obtenues √† partir d'autres donn√©es. Les √©tats d√©riv√©s (calcul√©s) ne doivent pas √™tre pr√©sents dans le <em>state</em>.</p>
<p align="center">
<img src="https://www.dropbox.com/s/aj8zj878ivnf7n6/selectors0.svg?dl=1" width="260">
</p>
<p>Le &quot;bon&quot; endroit pour filtrer et afficher cette liste est donc la m√©thode <em>render</em>. Ainsi, si un crit√®re de recherche ou si les donn√©es changent, le composant ex√©cute la m√©thode <code>render</code>, filtre les donn√©es et les affiche. Il en r√©sulte une <em>UI</em> toujours synchronis√©e avec le <em>state</em>.</p>
<p>Cette technique pr√©sente n√©anmoins un inconv√©nient. Supposons qu'une <em>props</em> <strong>autre</strong> que les filtres et la liste de personnes, change : le filtrage de la liste se fera donc, <strong>inutilement</strong>, √† chaque <em>update</em> du composant.</p>
<p>La complexit√© de ce filtrage √©tant du 0(n), cela n'est pas tr√®s g√™nant si la taille des donn√©es √† filtre reste mod√©r√©e.</p>
<p>Cependant, des listes de donn√©es potentiellement grandes ou m√™me un calcul plus complexe d√©graderaient fortement les performances de l'application.</p>
<p>C'est ici qu'entrent en jeu les <strong>selectors</strong>:</p>
<p align="center">
<img src="https://www.dropbox.com/s/7gxp1rrntx2lhmj/selectors.svg?dl=1" width="300">
</p>
<p>Les <em>selectors</em> <strong>calculent des donn√©es d√©riv√©es</strong>. Ils permettent au <em>state</em> de ne stocker que les <strong>donn√©es minimis√©e</strong>. Ils sont <strong>efficaces</strong> et ne sont <strong>pas recalcul√©s</strong> si les arguments restent les m√™mes ‚Üí ils sont <strong>m√©mois√©s</strong>. Enfin ils sont <em>composables</em>, c'est-√†-dire qu'ils peuvent √™tre utilis√©s en entr√©es d'autres <em>selectors</em>. Ainsi toute la complexit√© est <em>d√©plac√©e</em> √† l'exterieur et prise en charge par les <strong>selectors</strong>,</p>
<p>Les <em>selectors</em> jouent le r√¥le d'<em>api</em>, permettant un acc√®s au <em>state</em>. Les composants React ne connaisse que cette interface. Une cons√©quence directe est le <em>d√©couplage</em> de ces composants vis-√†-vis de la <em>forme</em> du <em>state</em>. Un autre b√©n√©fice est la simplification du code des composants React.</p>
<h4 id="exemple-avec-la-biblioth√®que-reselect">Exemple avec la biblioth√®que <a href="https://github.com/reactjs/reselect">reselect</a></h4>
<h5 id="d√©finition-des-selectors">D√©finition des <em>selectors</em></h5>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">const</span> getUsers <span class="op">=</span> state <span class="op">=&gt;</span> <span class="va">state</span>.<span class="at">users</span>
<span class="kw">const</span> getSearchTerm <span class="op">=</span> state <span class="op">=&gt;</span> <span class="va">state</span>.<span class="at">searchTerm</span>

<span class="co">// Memoized selector</span>
<span class="kw">const</span> getFilteredUsers <span class="op">=</span> <span class="at">createSelector</span>(
  getUsers<span class="op">,</span>
  getSearchTerm<span class="op">,</span>
  (users<span class="op">,</span> searchTerm) <span class="op">=&gt;</span> <span class="va">users</span>.<span class="at">filter</span>(
    user <span class="op">=&gt;</span> <span class="va">user</span>.<span class="at">indexOf</span>(searchTerm) <span class="op">&gt;</span> <span class="op">-</span><span class="dv">1</span>
  )
)<span class="op">;</span></code></pre></div>
<h5 id="d√©finition-du-composant-react">D√©finition du composant React</h5>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Composant React - liste d&#39;utilisateurs </span>
<span class="kw">const</span> UserList <span class="op">=</span> (<span class="op">{</span> filteredUsers <span class="op">}</span>) <span class="op">=&gt;</span> (
  <span class="op">&lt;</span>ul<span class="op">&gt;</span>
    <span class="op">{</span><span class="va">filteredUsers</span>.<span class="at">map</span>(user <span class="op">=&gt;</span> <span class="op">&lt;</span>li<span class="op">&gt;{</span>user<span class="op">}&lt;</span><span class="ss">/li&gt;</span><span class="sc">)</span><span class="ss">}</span>
<span class="ss">  &lt;/ul</span><span class="op">&gt;</span>
)<span class="op">;</span></code></pre></div>
<h5 id="cr√©ation-du-container">Cr√©ation du container</h5>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(state <span class="op">=&gt;</span> (
  filteredUsers<span class="op">:</span> <span class="at">getFilteredUsers</span>(state)
))(UserList)<span class="op">;</span></code></pre></div>
<blockquote>
<p>Note : Nous avons seulement besoin de transmettre la liste filtr√©e au composant <em>UserList</em>. <code>connect</code> suffit √† cr√©er le composant <em>container</em>.</p>
</blockquote>
<blockquote>
<p>Note 1 : Le <em>pattern</em> <em>mapStateToProps</em> √©tant r√©current, un sucre syntaxique serait :</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(<span class="at">createStructuredSelector</span>(<span class="op">{</span>
  <span class="dt">filteredUsers</span><span class="op">:</span> getFilteredUsers<span class="op">,</span>
<span class="op">}</span>))(UserList)<span class="op">;</span></code></pre></div>
<h3 id="structurer-le-state">Structurer le State</h3>
<p>TODO: ..</p>
<hr />
<h3 id="r√©f√©rences">R√©f√©rences</h3>
<ul>
<li><em>React</em> - https ://facebook.github.io/react</li>
<li><em>Redux doc</em> - http://redux.js.org</li>
<li><em>Smart and dumb component</em> - https://medium.com/<span class="citation">@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0</span>#.h6rxn85kl</li>
<li><em>React and flux in production best practices</em> - https://medium.com/<span class="citation">@delveeng/react-and-flux-in-production-best-practices-c87766c57cb6</span>#.elbdrmo4f</li>
<li><em>Javascript callback hell</em> - http://callbackhell.com</li>
<li><em>Async await proposal</em> - https://tc39.github.io/ecmascript-asyncawait</li>
</ul>
